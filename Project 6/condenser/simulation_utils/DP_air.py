import numpy as np
import CoolProp.CoolProp as CP
from condenser.simulation_utils.airside_dpdz_Chang_Wang_1996 import airside_dpdz_Chang_Wang_1996
from condenser.simulation_utils.airside_dpdz_Chang_Wang_1999 import airside_dpdz_Chang_Wang_1999
from scipy import interpolate

def DP_air(self,T_ai,P_ai,T_ao,P_ao_tmp):
    '''
        Calculate pressure drop through louver fins of air
    '''
    sigma_K_c=np.array([0.0998923586380184,0.1533285509902264,0.20114352910644695,0.2559862929607125,0.30027807995879835,\
        0.35159596210418154,0.4008039869964784,0.4528217737113951,0.5006147741478959,0.5540272982296366,0.6018135363031468,\
        0.6481915122838517,0.7030004643231641,0.7521797491727505,0.8027672961151423,0.856154461335668,0.902517221999644,\
        0.9488799826636198,0.9980457427872251])
    K_c_tmp=np.array([0.39802350427350386,0.3896768162393158,0.3844601362179483,0.37611344818376025,0.3667234241452988,\
        0.3531600560897432,0.3395966880341874,0.323946647970085,0.3051665998931621,0.2822132077991448,0.25925981570512757,\
        0.23526308760683734,0.20604967948717912,0.17474959935897405,0.1444928552350424,0.10588942307692273,0.0725026709401706,\
        0.03911591880341825,-0.0005308493589750718])
    sigma_K_e=np.array([0.10196840407615151,0.14404551719479566,0.20156279561186796,0.24785962323668492,0.2997776650974894,\
        0.3531090408233421,0.4008344176299364,0.4499731283015789,0.5012250774078031,0.5496790988266411,0.6016529301821186,\
        0.653631833309839,0.7028128087501732,0.7527021417137791,0.8025982370403758,0.8532060710717395,0.9024124053732887,\
        0.9488157402152091,0.9987473379475063])
    K_e_tmp=np.array([0.8111845619658116,0.7371077056623927,0.6432074652777773,0.5691306089743584,0.49192374465811906,\
        0.41889022435897405,0.35837673611111076,0.3020365918803414,0.24778311965811906,0.2029196714743584,0.16014289529914527,\
        0.12049612713675151,0.09023938301282008,0.06311264690170915,0.04015925480769189,0.022422542735042184,0.007815838675213183,\
        -0.0005308493589748497,-0.0015741853632484926])

    K_c_interpolate=interpolate.UnivariateSpline(sigma_K_c,K_c_tmp,s=0)        # pass all the points forceabley
    K_e_interpolate=interpolate.UnivariateSpline(sigma_K_e,K_e_tmp,s=0)
    K_c=K_c_interpolate(self.sigma)
    K_e=K_e_interpolate(self.sigma)
    rho_ai = CP.PropsSI('D','T',T_ai+273.15,'P',P_ai*1e3,'Air')
    rho_ao = CP.PropsSI('D','T',T_ao+273.15,'P',P_ao_tmp*1e3,'Air')
    f_air = airside_dpdz_Chang_Wang_1999(self,self.T_ai,self.P_ai,self.P_louver,self.P_fin,self.h_fin,\
        self.t_fin,self.Dh_fin,self.L_louver,self.D_fin,self.P_tube,self.t_tube,self.theta_louver)
    DELTAP_air = airside_dpdz_Chang_Wang_1996(f_air,self.A_air_free,self.A_air_tot,self.A_front,rho_ai,rho_ao,self.G_air,K_c,K_e)

    return DELTAP_air